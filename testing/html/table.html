<!DOCTYPE html>
<!--- Author: Ante Dujic -->
<html lang="en">

<head>
	<title>Table</title>
	<meta charset="UTF-8">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
	<script src="./ajaxcalls.js"></script>
</head>

<style>

	* { font-family: Arial; }
	
	.visited-table {
		border-collapse: collapse;
		margin: 25px 0;
		font-size: 0.9em;
		min-width: 400px;
		border-radius: 10px 10px 0 0;
		overflow: hidden;
	}
	
	.visited-table thead tr {
		background-color: #468EC1;
		color: #ffffff;
		text-align: center;
		font-weight: bold;
	}
	
	.visited-table tbody tr {
		border-bottom: 1px solid #dddddd;
	}
	
	
	.visited-table tbody tr:last-of-type{
		border-bottom: 2px solid #468EC1;
	}
	
	.visited-table tbody td {
		text-align: center;
	}
	
	.visited-table th,
	.visited-table td {
		padding: 12px 15px;
		
	}
	
	tr.active {
		background-color: #F5C1A9;
	}
</style>


<body>
	<h1>VISITED DESTINATIONS</h1>
	<table class="visited-table" id="destinationTable">
	
		<thead>
			<tr>
				<th> ID </th>
				<th> Destination </th>
				<th> DOV </th>
				<th> Hospitality </th>
				<th> Food </th>
				<th> Transport </th>
				<th> Attractions </th>
				<th> Entertainment </th>	
			</tr>
		</thead>
		
	
			<tbody>
			<tr class="form" id="form">
				<td> <input type="hidden" name="id"> </td>
				<td> <input type="text" name="destination"> </td>
				<td> <input type="date" name="dov"> </td>
				<td> <input type="number" min="1" max="10" name="hospitality"> </td>
				<td> <input type="number" min="1" max="10" name="food"> </td>
				<td> <input type="number" min="1" max="10" name="transport"> </td>
				<td> <input type="number" min="1" max="10" name="attractions"> </td>
				<td> <input type="number" min="1" max="10" name="entertainment"> </td>
				<td> <input type="button" id="add" value="ADD" onclick="doCreate()"> </td>
			</tr>
			</tbody>
	</table>
</body>

<script>
	function getDestinationFromForm(){
		
		var form = document.getElementById('form')
		var destination_details = {}
		
		destination_details.id = form.querySelector('input[name="id"]').value
		destination_details.destination = form.querySelector('input[name="destination"]').value
		destination_details.dov = form.querySelector('input[name="dov"]').value
		destination_details.hospitality = form.querySelector('input[name="hospitality"]').value
		destination_details.food = form.querySelector('input[name="food"]').value
		destination_details.transport = form.querySelector('input[name="transport"]').value
		destination_details.attractions = form.querySelector('input[name="attractions"]').value
		destination_details.entertainment = form.querySelector('input[name="entertainment"]').value
		console.log(JSON.stringify(destination_details))
		return destination_details
	}
	
	function addToTable(destination_details){
            var tableElement = document.getElementById('destinationTable')
            var rowElement = tableElement.insertRow(-1)
            
            rowElement.setAttribute('id',destination_details.id)
            
            var cell1 = rowElement.insertCell(0);
            cell1.innerHTML = destination_details.id
			
			var cell2 = rowElement.insertCell(1);
            cell2.innerHTML = destination_details.city
			
			var cell3 = rowElement.insertCell(2);
            cell3.innerHTML = destination_details.dov.slice(5,16)
			
			var cell4 = rowElement.insertCell(3);
            cell4.innerHTML = destination_details.hospitality
			
			var cell5 = rowElement.insertCell(4);
            cell5.innerHTML = destination_details.food
			
			var cell6 = rowElement.insertCell(5);
            cell6.innerHTML = destination_details.transport
			
			var cell7 = rowElement.insertCell(6);
            cell7.innerHTML = destination_details.attractions
			
			var cell8 = rowElement.insertCell(7);
            cell8.innerHTML = destination_details.entertainment
			
			var cell9 = rowElement.insertCell(8);
            cell9.innerHTML = '<button id="edit" name="edit" onclick="doUpdate(this)">Edit</button>';
			
			var cell10 = rowElement.insertCell(9);
            cell10.innerHTML = '<button id="delete" name="delete">Delete</button>';
			
			
		}

	function doCreate(){
	
			var form = document.getElementById('form')
			var destination_details = {}
			
			
			destination_details.city = form.querySelector('input[name="destination"]').value
			destination_details.dov = form.querySelector('input[name="dov"]').value
			destination_details.hospitality = form.querySelector('input[name="hospitality"]').value
			destination_details.food = form.querySelector('input[name="food"]').value
			destination_details.transport = form.querySelector('input[name="transport"]').value
			destination_details.attractions = form.querySelector('input[name="attractions"]').value
			destination_details.entertainment = form.querySelector('input[name="entertainment"]').value
			console.log(JSON.stringify(destination_details))
			createDestination(destination_details)
			location.reload();
		}




	function getItemFromRow(rowElement){
        var destination ={}
		
        
		destination.destination = rowElement.cells[1].firstChild.textContent
		destination.dov = rowElement.cells[1].firstChild.textContent
		destination.hospitality = rowElement.cells[3].firstChild.textContent
		destination.food = rowElement.cells[4].firstChild.textContent
		destination.transport = rowElement.cells[5].firstChild.textContent
		destination.attractions = rowElement.cells[6].firstChild.textContent
		destination.entertainment = rowElement.cells[7].firstChild.textContent
		
        return destination
    }

	function setInRow(rowElement, destination){
        rowElement.cells[0].firstChild.textContent= destination.id
		rowElement.cells[1].firstChild.textContent= destination.destination
		rowElement.cells[2].firstChild.textContent= destination.dov
		rowElement.cells[3].firstChild.textContent= destination.hospitality 
		rowElement.cells[4].firstChild.textContent= destination.food
		rowElement.cells[5].firstChild.textContent= destination.transport
		rowElement.cells[6].firstChild.textContent= destination.attractions
		rowElement.cells[7].firstChild.textContent= destination.entertainment
    }

	function populateFormWithItem(item){
        var form = document.getElementById('createUpdateForm')
        //form.querySelector('input[name="id"]').disabled = true
        form.querySelector('input[name="id"]').value  = item.id
        form.querySelector('input[name="destination"]').value
        form.querySelector('input[name="dov"]').value
        form.querySelector('input[name="hospitality"]').value
		form.querySelector('input[name="food"]').value
		form.querySelector('input[name="transport"]').value
		form.querySelector('input[name="attractions"]').value
		form.querySelector('input[name="entertainment"]').value
        return item
    }

	function doUpdate(buttonElement){
			
			var rowElement = buttonElement.parentNode.parentNode
					
			var item = getItemFromRow(rowElement)
			populateFormWithItem(item)
			var destination = getDestinationFromForm();
			var rowElement = document.getElementById(destination.id);
			updateDestination(destination);
			setInRow(rowElement,destination);
		
			clearForm();
			showViewAll();
		}
		
	getAll()



	$(function() {
		$('td').click(function() {
			$('tr').removeClass('active');
			$(this).parent().addClass('active');
		});
	});




</script>


</html>